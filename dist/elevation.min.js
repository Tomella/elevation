!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e(t.Elevation=t.Elevation||{})}(this,function(t){"use strict";function e(t,e){function n(){this.constructor=t}for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o]);t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}function n(t){for(var e=t;e<=-Math.PI;)e+=2*Math.PI;for(;e>Math.PI;)e-=2*Math.PI;return e}function o(t,e){t[0]=Math.min(t[0],e[0]),t[1]=Math.min(t[1],e[1]),t[2]=Math.max(t[2],e[0]),t[3]=Math.max(t[3],e[1])}function i(t,e){var n=e[0]<t[0]?t[0]:e[0],o=e[2]>t[2]?t[2]:e[2],i=e[1]<t[1]?t[1]:e[1],r=e[3]>t[3]?t[3]:e[3];return n>e[2]||o<e[0]||r<e[1]||i>e[3]||n>=o||r<=i?null:[n,i,o,r]}function r(t){var e=[1/0,1/0,-(1/0),-(1/0)];return t.forEach(function(t){o(e,t)}),e}function s(t,e){return t[0]<=e[0]&&t[1]<=e[1]&&t[2]>=e[0]&&t[3]>=e[1]}function a(t,e){for(var n=c(t),o=h(t)/(e-1),i=0,r=[t[0]],s=1;s<e-1;s++){for(var a=o*s;a>n[i].startOrigin+n[i].length;)i++;var l=n[i],p=u(l.start,l.bearing,a-l.startOrigin);r.push(p)}return r.push(t[t.length-1]),r}function u(t,e,o){var i=o/6371e3,r=b(e),s=b(t[0]),a=b(t[1]),u=(Math.sin(a),Math.cos(a),Math.asin(Math.sin(a)*Math.cos(i)+Math.cos(a)*Math.sin(i)*Math.cos(r))),c=s+Math.atan2(Math.sin(r)*Math.sin(i)*Math.cos(a),Math.cos(i)-Math.sin(a)*Math.sin(u));return c=n(c+3*Math.PI),[y(c),y(u)]}function c(t){if(t.length<2)return[0];for(var e=[],n=0,o=1;o<t.length;o++){var i=l(t[o-1],t[o]),r=n+i;e.push({start:t[o-1],end:t[o],bearing:f(t[o-1],t[o]),length:i,startOrigin:n}),n=r}return e}function h(t){var e=0;if(t.length>1)for(var n=1;n<t.length;n++)e+=l(t[n-1],t[n]);return e}function l(t,e){var n=t[0],o=t[1],i=e[0],r=e[1],s=b(r-o),a=b(i-n),u=Math.pow(Math.sin(s/2),2)+Math.cos(b(o))*Math.cos(b(r))*Math.pow(Math.sin(a/2),2),c=2*Math.atan2(Math.sqrt(u),Math.sqrt(1-u));return c*d}function p(t,e,n){var o=b(t[0]),i=b(t[1]),r=b(n),s=e*v,a=Math.asin(Math.sin(i)*Math.cos(s)+Math.cos(i)*Math.sin(s)*Math.cos(r)),u=o+Math.atan2(Math.sin(r)*Math.sin(s)*Math.cos(i),Math.cos(s)-Math.sin(i)*Math.sin(a));return[y(u),y(a)]}function f(t,e){var n=b(t[0]),o=b(t[1]),i=b(e[0]),r=b(e[1]),s=Math.sin(i-n)*Math.cos(r),a=Math.cos(o)*Math.sin(r)-Math.sin(o)*Math.cos(r)*Math.cos(i-n);return y(Math.atan2(s,a))}var d=6371e3,v=1/d,b=function(t){return function(e){return e*t}}(Math.PI/180),y=function(t){return function(e){return e*t}}(180/Math.PI),g=function(){function t(t,e,n,o){void 0===t&&(t=-180),void 0===e&&(e=-90),void 0===n&&(n=180),void 0===o&&(o=-90),this._extent=[],this._extent=[t,e,n,o]}return Object.defineProperty(t.prototype,"lngMin",{get:function(){return this._extent[0]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"latMin",{get:function(){return this._extent[1]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"lngMax",{get:function(){return this._extent[2]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"latMax",{get:function(){return this._extent[3]},enumerable:!0,configurable:!0}),t.prototype.set=function(t){return this._extent=[t.lngMin,t.latMin,t.lngMax,t.latMin],this},t.prototype.setFromPoints=function(t){return this._extent=r(t),this},t.prototype.expand=function(t){return o(this._extent,t),this},t.prototype.toBbox=function(){return[this.lngMin,this.latMin,this.lngMax,this.latMax]},t.prototype.clone=function(){return(new t).set(this)},t}();g.AUSTRALIA=new g(113,(-44),154,(-10)),g.WORLD=new g((-180),(-90),180,90),g.REVERSE_WORLD=new g(180,90,(-180),(-90));var M=function(){function t(t){this.serviceUrlTemplate=t,this.diagonal=500}return t.prototype.getElevation=function(t,e){var n=this;return void 0===e&&(e=0),new Promise(function(t,e){n.extent=new g})},t.calcSides=function(t,e){var n=Math.sqrt(t*t/(1+e*e));return{y:Math.ceil(n),x:Math.ceil(n*e)}},t}(),x=function(){function t(){}return t.prototype.addEventListener=function(t,e){void 0===this.listeners&&(this.listeners={});var n=this.listeners;void 0===n[t]&&(n[t]=[]),n[t].indexOf(e)===-1&&n[t].push(e)},t.prototype.hasEventListener=function(t,e){if(void 0===this.listeners)return!1;var n=this.listeners;return void 0!==n[t]&&n[t].indexOf(e)!==-1},t.prototype.removeEventListener=function(t,e){if(void 0!==this.listeners){var n=this.listeners[t];void 0!==n&&(this.listeners[t]=n.filter(function(t){return e!==t}))}},t.prototype.dispatchEvent=function(t){var e=this,n=this.listeners;if(void 0!==n){var o=n[t.type];void 0!==o&&(t.target=this,o.forEach(function(n){return n.call(e,t)}))}},t.prototype.removeAllListeners=function(){this.listeners=void 0},t}(),m=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return e(n,t),n}(x),w=function(){function t(t,e,n){this.type=t,this.data=e,this.target=n}return t}(),O=function(t){function n(e,n,o){void 0===n&&(n={});var i=t.call(this)||this;return i.file=e,i.callback=o,i.reader=new FileReader,i}return e(n,t),n.prototype.load=function(){var t=this;return new Promise(function(e,n){var o=t;t.reader.onloadend=function(t){if(console.log("We have loaded with ready state = "+t.target.readyState),t.target.readyState===FileReader.prototype.DONE){var n=t.target.result;o.dispatchEvent(new w("data",n)),o.dispatchEvent(new w("complete",n)),e(n)}},t.reader.onerror=function(e){t.dispatchEvent(new w("error",{event:e})),n(e)},o.reader.readAsArrayBuffer(o.file)})},n}(m),E=function(t){function n(e,n){void 0===n&&(n={});var o=t.call(this)||this;return o.location=e,o.options=n,o}return e(n,t),n.prototype.load=function(){var t=this;return new Promise(function(e,n){var o=0,i=new XMLHttpRequest;i.addEventListener("readystatechange",function(n){if(null===i.readyState||!(i.readyState<3||200!==i.status)){var r=i.responseText;t.dispatchEvent(new w("data",r.substr(o))),o=r.length,4===i.readyState&&(t.dispatchEvent(new w("complete",i.responseText)),e(r))}},!1),i.addEventListener("error",function(e){t.dispatchEvent(new w("error",{event:e})),n(e)},!1),void 0!==t.options.crossOrigin&&(i.crossOrigin=t.options.crossOrigin),i.open("GET",t.location,!0),i.responseType="arraybuffer",i.send(null)})},Object.defineProperty(n.prototype,"crossOrigin",{set:function(t){this.options.crossOrigin=t},enumerable:!0,configurable:!0}),n}(m),L=function(t){function n(e){void 0===e&&(e={});var n=t.call(this)||this;return n.options=e,n}return e(n,t),n.prototype.load=function(){var t=this,e=this.options.loader?this.options.loader:new P(this.options);return void 0!==this.options.crossOrigin&&(e.crossOrigin=this.options.crossOrigin),e.load().then(function(e){var n=new GeotiffParser;return n.parseHeader(e),t.dispatchEvent(new w("header",{width:n.imageWidth,height:n.imageLength})),n.loadPixels()})},Object.defineProperty(n.prototype,"crossOrigin",{set:function(t){this.options.crossOrigin=t},enumerable:!0,configurable:!0}),n}(m),P=function(t){function n(e){void 0===e&&(e={});var n=t.call(this)||this;return n.options=e,n}return e(n,t),n.prototype.load=function(){var t=this;return new Promise(function(e,n){var o=i(t.options.extent.toBbox(),t.options.bbox);if(!o)return void n("Not within the data extent");var r=new XMLHttpRequest;r.addEventListener("load",function(t){e(t.target.response)},!1),r.addEventListener("error",function(t){n(t)},!1),void 0!==t.options.crossOrigin&&(r.crossOrigin=t.options.crossOrigin),r.open("GET",t.options.location,!0),r.responseType="arraybuffer",r.send(null)})},Object.defineProperty(n.prototype,"crossOrigin",{set:function(t){this.options.crossOrigin=t},enumerable:!0,configurable:!0}),n}(m),X=function(){function t(t){this.options=t}return t.prototype.load=function(){var t=this;return new L(this.options).load().then(function(e){return[t.options.point[0],t.options.point[1],e[0]]})},t}(),j=function(){function t(t,e){this.template=t,this.point=e}return Object.defineProperty(t.prototype,"extent",{get:function(){return new(g.bind.apply(g,[void 0].concat(this.bbox)))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"bbox",{get:function(){return[this.point[0]-1e-6,this.point[1]-1e-6,this.point[0]+1e-6,this.point[1]+1e-6]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"location",{get:function(){return this.template.replace("${resx}",1).replace("${resy}",1).replace("${width}",1).replace("${height}",1).replace("${bbox}",this.bbox.join(","))},enumerable:!0,configurable:!0}),t}(),R=function(t){function n(e,n,o){void 0===o&&(o={});var i=t.call(this)||this;return i.template=e,i.point=n,i.options=o,i}return e(n,t),n.prototype.load=function(){var t=Object.assign(new j(this.template,this.point),this.options),e=new X(t);return e.load()},n}(m),_=function(){function t(t,e,n){void 0===n&&(n={resolutionX:500}),this.template=t,this.bbox=e,this.options=n}return Object.defineProperty(t.prototype,"resolutionY",{get:function(){return this._resolutionY?this._resolutionY:Math.round(this.resolutionX*(this.bbox[3]-this.bbox[1])/(this.bbox[2]-this.bbox[0]))},set:function(t){this._resolutionY=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"resolutionX",{get:function(){return this.options.resolutionX},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"extent",{get:function(){return this.options.extent?this.options.extent:g.WORLD},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"location",{get:function(){return this.template.replace("${resx}",this.resolutionX).replace("${resy}",this.resolutionY).replace("${width}",this.resolutionX).replace("${height}",this.resolutionY).replace("${bbox}",this.bbox.join(","))},enumerable:!0,configurable:!0}),t}(),T=function(){function t(t,e,n,o){void 0===n&&(n=500),this.template=t,this.bbox=e,this.resolutionX=n,this.resolutionY=o}return t.prototype.load=function(){var t=new _(this.template,this.bbox,{resolutionX:this.resolutionX,resoltionY:this.resolutionY}),e=new L(t);return e.load()},t}(),Y=function(t){function n(e){var n=t.call(this)||this;return n.options=e,n.resolutionX=500,n.extent=g.WORLD,n.childLoader=new L(e),n}return e(n,t),n.prototype.load=function(){var t=this.options,e=(this.options.template,t.bbox),n=(e[2]-e[0])/(t.resolutionX-1),o=(e[3]-e[1])/(t.resolutionY-1),i=e[3],r=e[0];return this.childLoader.load().then(function(e){return e.map(function(e,s){var a=s%t.resolutionX,u=Math.floor(s/t.resolutionX);return{x:r+a*n,y:i-u*o,z:e}})})},n}(m),S=function(t){function n(e){var n=t.call(this)||this;return n.options=e,n.childLoader=new Y(e),n}return e(n,t),n.prototype.load=function(){var t=this.options,e=t.bbox;(e[2]-e[0])/(t.resolutionX-1),(e[3]-e[1])/(t.resolutionY-1),e[1],e[0];return this.childLoader.load().then(function(t){var n={type:"FeatureCollection",bbox:[e[0],e[1],e[2],e[3]],features:t.map(function(t){return{type:"Feature",properties:[],geometry:{type:"Point",coordinates:[t.x,t.y,t.z]}}})};return n})},n.prototype.calculateResolutionY=function(t,e,n){return n?n:Math.round(e*(t[3]-t[1])/(t[2]-t[0]))},n}(m),D=function(){function t(t,e,n,o){void 0===n&&(n=500),this.template=t,this.bbox=e,this.resolutionX=n,this.resolutionY=o}return t.prototype.load=function(){var t=new _(this.template,this.bbox,{resolutionX:this.resolutionX,resoltionY:this.resolutionY}),e=new S(t);return e.load()},t}(),A=function(){function t(t,e,n,o){void 0===n&&(n=500),this.template=t,this.bbox=e,this.resolutionX=n,this.resolutionY=o}return t.prototype.load=function(){var t=new _(this.template,this.bbox,{resolutionX:this.resolutionX,resoltionY:this.resolutionY}),e=new Y(t);return e.load()},t}(),I=function(){function t(t){this.options=t,this.childLoader=new L(t)}return t.prototype.load=function(){var t=this;return this.childLoader.load().then(function(e){var n,o=[];return e.forEach(function(e,i){i%t.options.resolutionX||(n=[],o.push(n)),n.push(e)}),o})},t}();t.Extent2d=g,t.Transection=M,t.FileLoader=O,t.HttpTextLoader=E,t.CswPointElevationLoader=R,t.CswTerrainLoader=T,t.CswGeoJsonLoader=D,t.CswXyzLoader=A,t.TerrainLoader=L,t.PointElevationLoader=X,t.GeojsonElevationLoader=S,t.GridElevationLoader=I,t.XyzElevationLoader=Y,t.RADIANS_TO_METERS=d,t.METERS_TO_RADIANS=v,t.convertDegreesToRadians=b,t.convertRadiansToDegree=y,t.normalizeRadians=n,t.expandBbox=o,t.culledBbox=i,t.createBboxFromPoints=r,t.positionWithinBbox=s,t.densify=a,t.calculatePosition=u,t.calculateSegmentDetails=c,t.calculateLineLength=h,t.calculateDistance=l,t.destination=p,t.calculateBearing=f,Object.defineProperty(t,"__esModule",{value:!0})});