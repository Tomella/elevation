!function(t,n){"object"==typeof exports&&"undefined"!=typeof module?n(exports):"function"==typeof define&&define.amd?define(["exports"],n):n(t.Elevation=t.Elevation||{})}(this,function(t){"use strict";function n(t){for(var n=t;n<=-Math.PI;)n+=2*Math.PI;for(;n>Math.PI;)n-=2*Math.PI;return n}function e(t,n){t[0]=Math.min(t[0],n[0]),t[1]=Math.min(t[1],n[1]),t[2]=Math.max(t[2],n[0]),t[3]=Math.max(t[3],n[1])}function i(t){var n=[1/0,1/0,-(1/0),-(1/0)];return t.forEach(function(t){e(n,t)}),n}function r(t,n){return t[0]<=n[0]&&t[1]<=n[1]&&t[2]>=n[0]&&t[3]>=n[1]}function o(t,n){for(var e=s(t),i=u(t)/(n-1),r=0,o=[t[0]],c=1;c<n-1;c++){for(var h=i*c;h>e[r].startOrigin+e[r].length;)r++;var f=e[r],M=a(f.start,f.bearing,h-f.startOrigin);o.push(M)}return o.push(t[t.length-1]),o}function a(t,e,i){var r=i/6371e3,o=d(e),a=d(t[0]),s=d(t[1]),u=(Math.sin(s),Math.cos(s),Math.asin(Math.sin(s)*Math.cos(r)+Math.cos(s)*Math.sin(r)*Math.cos(o))),c=a+Math.atan2(Math.sin(o)*Math.sin(r)*Math.cos(s),Math.cos(r)-Math.sin(s)*Math.sin(u));return c=n(c+3*Math.PI),[g(c),g(u)]}function s(t){if(t.length<2)return[0];for(var n=[],e=0,i=1;i<t.length;i++){var r=c(t[i-1],t[i]),o=e+r;n.push({start:t[i-1],end:t[i],bearing:f(t[i-1],t[i]),length:r,startOrigin:e}),e=o}return n}function u(t){var n=0;if(t.length>1)for(var e=1;e<t.length;e++)n+=c(t[e-1],t[e]);return n}function c(t,n){var e=t[0],i=t[1],r=n[0],o=n[1],a=d(o-i),s=d(r-e),u=Math.pow(Math.sin(a/2),2)+Math.cos(d(i))*Math.cos(d(o))*Math.pow(Math.sin(s/2),2),c=2*Math.atan2(Math.sqrt(u),Math.sqrt(1-u));return c*l}function h(t,n,e){var i=d(t[0]),r=d(t[1]),o=d(e),a=n*p,s=Math.asin(Math.sin(r)*Math.cos(a)+Math.cos(r)*Math.sin(a)*Math.cos(o)),u=i+Math.atan2(Math.sin(o)*Math.sin(a)*Math.cos(r),Math.cos(a)-Math.sin(r)*Math.sin(s));return[g(u),g(s)]}function f(t,n){var e=d(t[0]),i=d(t[1]),r=d(n[0]),o=d(n[1]),a=Math.sin(r-e)*Math.cos(o),s=Math.cos(i)*Math.sin(o)-Math.sin(i)*Math.cos(o)*Math.cos(r-e);return g(Math.atan2(a,s))}function M(t){setTimeout(t)}var l=6371e3,p=1/l,d=function(t){return function(n){return n*t}}(Math.PI/180),g=function(t){return function(n){return n*t}}(180/Math.PI),v=function(){function t(t,n,e,i){void 0===t&&(t=-180),void 0===n&&(n=-90),void 0===e&&(e=180),void 0===i&&(i=-90),this._extent=[],this._extent=[t,n,e,i]}return Object.defineProperty(t.prototype,"lngMin",{get:function(){return this._extent[0]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"latMin",{get:function(){return this._extent[1]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"lngMax",{get:function(){return this._extent[2]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"latMax",{get:function(){return this._extent[3]},enumerable:!0,configurable:!0}),t.prototype.set=function(t){return this._extent=[t.lngMin,t.latMin,t.lngMax,t.latMin],this},t.prototype.setFromPoints=function(t){return this._extent=i(t),this},t.prototype.expand=function(t){return e(this._extent,t),this},t.prototype.toBbox=function(){return[this.lngMin,this.latMin,this.lngMax,this.latMax]},t.prototype.clone=function(){return(new t).set(this)},t}();v.AUSTRALIA=new v(113,(-44),154,(-10)),v.WORLD=new v((-180),(-90),180,90),v.REVERSE_WORLD=new v(180,90,(-180),(-90));var x=function(){function t(t){this.serviceUrlTemplate=t,this.diagonal=500}return t.prototype.getElevation=function(t,n){var e=this;return void 0===n&&(n=0),new Promise(function(t,n){e.extent=new v})},t.calcSides=function(t,n){var e=Math.sqrt(t*t/(1+n*n));return{y:Math.ceil(e),x:Math.ceil(e*n)}},t}(),b=function(){function t(t){void 0===t&&(t={}),this.options=t}return t.prototype.load=function(t){var n=this;return new Promise(function(e,i){var r=new XMLHttpRequest;r.addEventListener("load",function(t){var n=new GeotiffParser;n.parseHeader(t.target.response),e(n.loadPixels())},!1),r.addEventListener("error",function(t){i(t)},!1),void 0!==n.options.crossOrigin&&(r.crossOrigin=n.options.crossOrigin),r.open("GET",t,!0),r.responseType="arraybuffer",r.send(null)})},Object.defineProperty(t.prototype,"crossOrigin",{set:function(t){this.options.crossOrigin=t},enumerable:!0,configurable:!0}),t}(),y=function(){function t(t,n){void 0===n&&(n=v.WORLD),this.template=t,this.extent=n}return t.prototype.load=function(t,n,e){r(this.extent.toBbox(),t)||M(function(){n(null)});var i=[t[0]-1e-6,t[1]-1e-6,t[0]+1e-6,t[1]+1e-6];return(new b).load(this.template.replace("{bbox}",i.join(","))).then(function(n){return[t[0],t[1],n[0]]})},t}();t.Extent2d=v,t.Transection=x,t.TerrainLoader=b,t.PointElevationLoader=y,t.RADIANS_TO_METERS=l,t.METERS_TO_RADIANS=p,t.convertDegreesToRadians=d,t.convertRadiansToDegree=g,t.normalizeRadians=n,t.expandBbox=e,t.createBboxFromPoints=i,t.positionWithinBbox=r,t.densify=o,t.calculatePosition=a,t.calculateSegmentDetails=s,t.calculateLineLength=u,t.calculateDistance=c,t.destination=h,t.calculateBearing=f,Object.defineProperty(t,"__esModule",{value:!0})});