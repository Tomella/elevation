!function(t,n){"object"==typeof exports&&"undefined"!=typeof module?n(exports):"function"==typeof define&&define.amd?define(["exports"],n):n(t.Elevation=t.Elevation||{})}(this,function(t){"use strict";function n(t,n){function e(){this.constructor=t}for(var o in n)n.hasOwnProperty(o)&&(t[o]=n[o]);t.prototype=null===n?Object.create(n):(e.prototype=n.prototype,new e)}function e(t){return t*Math.PI/180}function o(t){return 180*t/Math.PI}function r(t){for(var n=t;n<=-Math.PI;)n+=2*Math.PI;for(;n>Math.PI;)n-=2*Math.PI;return n}function i(t,n){t[0]=Math.min(t[0],n[0]),t[1]=Math.min(t[1],n[1]),t[2]=Math.max(t[2],n[0]),t[3]=Math.max(t[3],n[1])}function a(t,n){var e=n[0]<t[0]?t[0]:n[0],o=n[2]>t[2]?t[2]:n[2],r=n[1]<t[1]?t[1]:n[1],i=n[3]>t[3]?t[3]:n[3];return e>n[2]||o<n[0]||i<n[1]||r>n[3]||e>=o||i<=r?null:[e,r,o,i]}function s(t,n){void 0===n&&(n=0);var e=[1/0,1/0,-(1/0),-(1/0)];return t.forEach(function(t){i(e,t)}),n?u(e,n):e}function u(t,n){var e=(t[2]-t[0])*n,o=(t[3]-t[1])*n;return[t[0]-e,t[1]-o,t[2]+e,t[3]+o]}function c(t,n){return t[0]<=n[0]&&t[1]<=n[1]&&t[2]>=n[0]&&t[3]>=n[1]}function p(t,n){for(var e=l(t),o=f(t)/(n-1),r=0,i=[t[0]],a=1;a<n-1;a++){for(var s=o*a;s>e[r].startOrigin+e[r].length;)r++;var u=e[r],c=h(u.start,u.bearing,s-u.startOrigin);i.push(c)}return i.push(t[t.length-1]),i}function h(t,n,i){var a=i/6371e3,s=e(n),u=e(t[0]),c=e(t[1]),p=Math.asin(Math.sin(c)*Math.cos(a)+Math.cos(c)*Math.sin(a)*Math.cos(s)),h=u+Math.atan2(Math.sin(s)*Math.sin(a)*Math.cos(c),Math.cos(a)-Math.sin(c)*Math.sin(p));return h=r(h),[o(h),o(p)]}function l(t){if(t.length<2)return[0];for(var n=[],e=0,o=1;o<t.length;o++){var r=d(t[o-1],t[o]),i=e+r;n.push({start:t[o-1],end:t[o],bearing:y(t[o-1],t[o]),length:r,startOrigin:e}),e=i}return n}function f(t){var n=0;if(t.length>1)for(var e=1;e<t.length;e++)n+=d(t[e-1],t[e]);return n}function d(t,n){var o=t[0],r=t[1],i=n[0],a=n[1],s=e(a-r),u=e(i-o),c=Math.pow(Math.sin(s/2),2)+Math.cos(e(r))*Math.cos(e(a))*Math.pow(Math.sin(u/2),2),p=2*Math.atan2(Math.sqrt(c),Math.sqrt(1-c));return p*g}function v(t,n,r){var i=e(t[0]),a=e(t[1]),s=e(r),u=n*x,c=Math.asin(Math.sin(a)*Math.cos(u)+Math.cos(a)*Math.sin(u)*Math.cos(s)),p=i+Math.atan2(Math.sin(s)*Math.sin(u)*Math.cos(a),Math.cos(u)-Math.sin(a)*Math.sin(c));return[o(p),o(c)]}function y(t,n){var r=e(t[0]),i=e(t[1]),a=e(n[0]),s=e(n[1]),u=Math.sin(a-r)*Math.cos(s),c=Math.cos(i)*Math.sin(s)-Math.sin(i)*Math.cos(s)*Math.cos(a-r);return o(Math.atan2(u,c))}function b(t,n){var e=Math.sqrt(t*t/(1+n*n));return{y:Math.ceil(e),x:Math.ceil(e*n)}}var g=6371e3,x=1/g,M=function(){function t(t,n,e,o){void 0===t&&(t=-180),void 0===n&&(n=-90),void 0===e&&(e=180),void 0===o&&(o=-90),this._extent=[],this._extent=[t,n,e,o]}return Object.defineProperty(t.prototype,"lngMin",{get:function(){return this._extent[0]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"latMin",{get:function(){return this._extent[1]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"lngMax",{get:function(){return this._extent[2]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"latMax",{get:function(){return this._extent[3]},enumerable:!0,configurable:!0}),t.prototype.set=function(t){return this._extent=[t.lngMin,t.latMin,t.lngMax,t.latMax],this},t.prototype.setFromPoints=function(t){return this._extent=s(t),this},t.prototype.expand=function(t){return i(this._extent,t),this},t.prototype.toBbox=function(){return[this.lngMin,this.latMin,this.lngMax,this.latMax]},t.prototype.clone=function(){return(new t).set(this)},t}();M.AUSTRALIA=new M(113,(-44),154,(-10)),M.WORLD=new M((-180),(-90),180,90),M.REVERSE_WORLD=new M(180,90,(-180),(-90));var m=function(){function t(t){this.serviceUrlTemplate=t,this.diagonal=500}return t.prototype.getElevation=function(t,n){var e=this;return void 0===n&&(n=0),new Promise(function(t,n){e.extent=new M})},t.calcSides=function(t,n){var e=Math.sqrt(t*t/(1+n*n));return{y:Math.ceil(e),x:Math.ceil(e*n)}},t}(),O=function(){function t(){}return t.prototype.addEventListener=function(t,n){void 0===this.listeners&&(this.listeners={});var e=this.listeners;void 0===e[t]&&(e[t]=[]),e[t].indexOf(n)===-1&&e[t].push(n)},t.prototype.hasEventListener=function(t,n){if(void 0===this.listeners)return!1;var e=this.listeners;return void 0!==e[t]&&e[t].indexOf(n)!==-1},t.prototype.removeEventListener=function(t,n){if(void 0!==this.listeners){var e=this.listeners[t];void 0!==e&&(this.listeners[t]=e.filter(function(t){return n!==t}))}},t.prototype.dispatchEvent=function(t){var n=this,e=this.listeners;if(void 0!==e){var o=e[t.type];void 0!==o&&(t.target=this,o.forEach(function(e){return e.call(n,t)}))}},t.prototype.removeAllListeners=function(){this.listeners=void 0},t}(),w=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),e}(O),P=function(){function t(t,n,e){this.type=t,this.data=n,this.target=e}return t}(),E=function(t){function e(n,e,o){void 0===e&&(e={});var r=t.call(this)||this;return r.file=n,r.callback=o,r.reader=new FileReader,r}return n(e,t),e.prototype.load=function(){var t=this;return new Promise(function(n,e){var o=t;t.reader.onloadend=function(t){if(console.log("We have loaded with ready state = "+t.target.readyState),t.target.readyState===FileReader.prototype.DONE){var e=t.target.result;o.dispatchEvent(new P("data",e)),o.dispatchEvent(new P("complete",e)),n(e)}},t.reader.onerror=function(n){t.dispatchEvent(new P("error",{event:n})),e(n)},o.reader.readAsArrayBuffer(o.file)})},e}(w),L=function(t){function e(n){var e=t.call(this)||this;return e.options=n,e.loading=!1,e.options.data&&(e.data=e.options.data),e}return n(e,t),e.prototype.load=function(){var t=this;return this.data?Promise.resolve(this.data):(this.deferred||(this.deferred=this.options.loader.load().then(function(n){return t.data=n,n})),this.deferred)},e}(w),_=function(t){function e(n,e){void 0===e&&(e={});var o=t.call(this)||this;return o.location=n,o.options=e,o}return n(e,t),e.prototype.load=function(){var t=this;return new Promise(function(n,e){var o=0,r=new XMLHttpRequest;r.addEventListener("readystatechange",function(e){if(null===r.readyState||!(r.readyState<3||200!==r.status)){var i=r.responseText;t.dispatchEvent(new P("data",i.substr(o))),o=i.length,4===r.readyState&&(t.dispatchEvent(new P("complete",r.responseText)),n(i))}},!1),r.addEventListener("error",function(n){t.dispatchEvent(new P("error",{event:n})),e(n)},!1),void 0!==t.options.crossOrigin&&(r.crossOrigin=t.options.crossOrigin),r.open("GET",t.location,!0),r.responseType="text",r.send(null)})},Object.defineProperty(e.prototype,"crossOrigin",{set:function(t){this.options.crossOrigin=t},enumerable:!0,configurable:!0}),e}(w),j=function(t){function e(n){var e=t.call(this)||this;return e.options=n,e}return n(e,t),e.prototype.load=function(){function t(t){function n(t){var n=t.nd,o=n[0],r=n[n.length-1],a={type:"Feature",properties:e(t),geometry:{coordinates:[]}},s=a.geometry,u=s.coordinates;return r._ref===o._ref?(s.type="Polygon",u.push([]),u=u[0]):s.type="LineString",n.forEach(function(t){var n=i[t._ref],e=[+n._lon,+n._lat,0];u.push(e)}),a}function e(t){var n={};return t.tag.forEach(function(t){n[t._k]=t._v}),n}var o=t.osm,r=o.bounds,i={};o.node.forEach(function(t){i[t._id]=t});var a={type:"FeatureCollection",bbox:[+r._minlon,+r._minlat,+r._maxlon,+r._maxlat],features:o.way.map(function(t){return n(t)})};return a}var n=this.options.loader?this.options.loader:new _(this.options.location);return void 0!==this.options.crossOrigin&&(n.crossOrigin=this.options.crossOrigin),n.load().then(function(n){var e=new X2JS,o=e.xml_str2json(n);return t(o)})},e}(w),R=function(t){function e(n){void 0===n&&(n={});var e=t.call(this)||this;return e.options=n,e}return n(e,t),e.prototype.load=function(){var t=this,n=this.options.loader?this.options.loader:new T(this.options);return void 0!==this.options.crossOrigin&&(n.crossOrigin=this.options.crossOrigin),n.load().then(function(n){var e=new GeotiffParser;return e.parseHeader(n),t.dispatchEvent(new P("header",{width:e.imageWidth,height:e.imageLength})),e.loadPixels()})},Object.defineProperty(e.prototype,"crossOrigin",{set:function(t){this.options.crossOrigin=t},enumerable:!0,configurable:!0}),e}(w),T=function(t){function e(n){void 0===n&&(n={});var e=t.call(this)||this;return e.options=n,e}return n(e,t),e.prototype.load=function(){var t=this;return new Promise(function(n,e){var o=a(t.options.extent.toBbox(),t.options.bbox);if(!o)return void e("Not within the data extent");var r=new XMLHttpRequest;r.addEventListener("load",function(t){n(t.target.response)},!1),r.addEventListener("error",function(t){e(t)},!1),void 0!==t.options.crossOrigin&&(r.crossOrigin=t.options.crossOrigin),r.open("GET",t.options.location,!0),r.responseType="arraybuffer",r.send(null)})},Object.defineProperty(e.prototype,"crossOrigin",{set:function(t){this.options.crossOrigin=t},enumerable:!0,configurable:!0}),e}(w),X=function(){function t(t){this.options=t}return t.prototype.load=function(){var t=this;return new R(this.options).load().then(function(n){return[t.options.point[0],t.options.point[1],n[0]]})},t}(),S=function(){function t(t){void 0===t&&(t={}),this.options=t}return Object.defineProperty(t.prototype,"template",{get:function(){return this.options.point},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"point",{get:function(){return this.options.point},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"bbox",{get:function(){return[this.point[0]-1e-6,this.point[1]-1e-6,this.point[0]+1e-6,this.point[1]+1e-6]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"extent",{get:function(){return new(M.bind.apply(M,[void 0].concat(this.bbox)))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"location",{get:function(){return this.template.replace("${resx}",1).replace("${resy}",1).replace("${width}",1).replace("${height}",1).replace("${bbox}",this.bbox.join(","))},enumerable:!0,configurable:!0}),t}(),W=function(t){function e(n){void 0===n&&(n={});var e=t.call(this)||this;return e.options=n,e}return n(e,t),Object.defineProperty(e.prototype,"point",{set:function(t){this.options.point=t},enumerable:!0,configurable:!0}),e.prototype.load=function(){var t=new S(this.options),n=new X(t);return n.load()},e}(w),D=function(){function t(t){this.options=t}return Object.defineProperty(t.prototype,"resolutionY",{get:function(){return this.options.resolutionY?this.options.resolutionY:Math.round(this.options.resolutionX*(this.options.bbox[3]-this.options.bbox[1])/(this.options.bbox[2]-this.options.bbox[0]))},set:function(t){this.options.resolutionY=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"resolutionX",{get:function(){return this.options.resolutionX?this.options.resolutionX:500},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"template",{get:function(){return this.options.template},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"bbox",{get:function(){return this.options.bbox},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"extent",{get:function(){return this.options.extent?this.options.extent:M.WORLD},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"location",{get:function(){return this.template.replace("${resx}",this.resolutionX).replace("${resy}",this.resolutionY).replace("${width}",this.resolutionX).replace("${height}",this.resolutionY).replace("${bbox}",this.bbox.join(","))},enumerable:!0,configurable:!0}),t}(),F=function(){function t(t){void 0===t&&(t={}),this.options=t}return t.prototype.load=function(){var t=new D(this.options),n=new R(t);return n.load()},t}(),B=function(t){function e(n){var e=t.call(this)||this;return e.options=n,e.resolutionX=500,e.extent=M.WORLD,e.childLoader=new R(n),e}return n(e,t),e.prototype.load=function(){var t=this.options,n=(this.options.template,t.bbox),e=(n[2]-n[0])/(t.resolutionX-1),o=(n[3]-n[1])/(t.resolutionY-1),r=n[3],i=n[0];return this.childLoader.load().then(function(n){return n.map(function(n,a){var s=a%t.resolutionX,u=Math.floor(a/t.resolutionX);return{x:i+s*e,y:r-u*o,z:n}})})},e}(w),A=function(t){function e(n){var e=t.call(this)||this;return e.options=n,e.childLoader=new B(n),e}return n(e,t),e.prototype.load=function(){var t=this.options,n=t.bbox;(n[2]-n[0])/(t.resolutionX-1),(n[3]-n[1])/(t.resolutionY-1),n[1],n[0];return this.childLoader.load().then(function(t){var e={type:"FeatureCollection",bbox:[n[0],n[1],n[2],n[3]],features:t.map(function(t){return{type:"Feature",properties:[],geometry:{type:"Point",coordinates:[t.x,t.y,t.z]}}})};return e})},e.prototype.calculateResolutionY=function(t,n,e){return e?e:Math.round(n*(t[3]-t[1])/(t[2]-t[0]))},e}(w),I=function(){function t(t){void 0===t&&(t={}),this.options=t}return t.prototype.load=function(){var t=new D(this.options),n=new A(t);return n.load()},t}(),Y=function(){function t(t){this.options=t}return t.prototype.load=function(){var t=new D(this.options),n=new B(t);return n.load()},t}(),$=function(t){function e(n){void 0===n&&(n={});var e=t.call(this)||this;return e.options=n,e}return n(e,t),Object.defineProperty(e.prototype,"path",{set:function(t){this.options.path=t},enumerable:!0,configurable:!0}),e.prototype.load=function(){var t=s(this.options.path,this.options.buffer),n=this.options.extent?this.options.extent:M.WORLD;t=a(n.toBbox(),t);var e=Object.assign({bbox:t,extent:n,count:this.options.count?this.options.count:500},this.options),o=p(e.path,e.count?e.count:500),r=t[0],i=t[3],u=t[2]-r,c=i-t[1],h=b(e.count,u/c);return e.resolutionX=h.x,e.resolutionY=h.y,new R(new D(e)).load().then(function(t){function n(n){var e=n[0],o=n[1],a=r,s=i,p=Math.round((s-o)/c*(h.y-1)),l=Math.round((e-a)/u*(h.x-1)),f=p*h.x+l;return console.log("Cell x = "+l+", y = "+p+" Index = "+f+", value = "+t[f]),t[f]}return e.line?{type:"Feature",geometry:{type:"LineString",coordinates:o.map(function(t){return[t[0],t[1],n(t)]})}}:{type:"FeatureCollection",features:o.map(function(t){return{type:"Feature",geometry:{type:"Point",coordinates:[t[0],t[1],n(t)]}}})}})},e}(w),G=function(){function t(t){this.options=t,this.childLoader=new R(t)}return t.prototype.load=function(){var t=this;return this.childLoader.load().then(function(n){var e,o=[];return n.forEach(function(n,r){r%t.options.resolutionX||(e=[],o.push(e)),e.push(n)}),o})},t}();t.Extent2d=M,t.Transection=m,t.FileLoader=E,t.CachedLoader=L,t.HttpTextLoader=_,t.OsmGeoJsonLoader=j,t.WcsPointElevationLoader=W,t.WcsTerrainLoader=F,t.WcsGeoJsonLoader=I,t.WcsXyzLoader=Y,t.TerrainLoader=R,t.WcsPathElevationLoader=$,t.PointElevationLoader=X,t.GeojsonElevationLoader=A,t.GridElevationLoader=G,t.XyzElevationLoader=B,t.RADIANS_TO_METERS=g,t.METERS_TO_RADIANS=x,t.convertDegreesToRadians=e,t.convertRadiansToDegree=o,t.normalizeRadians=r,t.expandBbox=i,t.culledBbox=a,t.createBboxFromPoints=s,t.createBufferedBbox=u,t.positionWithinBbox=c,t.densify=p,t.calculatePosition=h,t.calculateSegmentDetails=l,t.calculateLineLength=f,t.calculateDistance=d,t.destination=v,t.calculateBearing=y,Object.defineProperty(t,"__esModule",{value:!0})});