!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e(t.Elevation=t.Elevation||{})}(this,function(t){"use strict";function e(t,e){function n(){this.constructor=t}for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o]);t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}function n(t){for(var e=t;e<=-Math.PI;)e+=2*Math.PI;for(;e>Math.PI;)e-=2*Math.PI;return e}function o(t,e){t[0]=Math.min(t[0],e[0]),t[1]=Math.min(t[1],e[1]),t[2]=Math.max(t[2],e[0]),t[3]=Math.max(t[3],e[1])}function r(t,e){var n=e[0]<t[0]?t[0]:e[0],o=e[2]>t[2]?t[2]:e[2],r=e[1]<t[1]?t[1]:e[1],i=e[3]>t[3]?t[3]:e[3];return n>e[2]||o<e[0]||i<e[1]||r>e[3]||n>=o||i<=r?null:[n,r,o,i]}function i(t){var e=[1/0,1/0,-(1/0),-(1/0)];return t.forEach(function(t){o(e,t)}),e}function s(t,e){return t[0]<=e[0]&&t[1]<=e[1]&&t[2]>=e[0]&&t[3]>=e[1]}function a(t,e){for(var n=c(t),o=p(t)/(e-1),r=0,i=[t[0]],s=1;s<e-1;s++){for(var a=o*s;a>n[r].startOrigin+n[r].length;)r++;var h=n[r],l=u(h.start,h.bearing,a-h.startOrigin);i.push(l)}return i.push(t[t.length-1]),i}function u(t,e,o){var r=o/6371e3,i=b(e),s=b(t[0]),a=b(t[1]),u=(Math.sin(a),Math.cos(a),Math.asin(Math.sin(a)*Math.cos(r)+Math.cos(a)*Math.sin(r)*Math.cos(i))),c=s+Math.atan2(Math.sin(i)*Math.sin(r)*Math.cos(a),Math.cos(r)-Math.sin(a)*Math.sin(u));return c=n(c+3*Math.PI),[y(c),y(u)]}function c(t){if(t.length<2)return[0];for(var e=[],n=0,o=1;o<t.length;o++){var r=h(t[o-1],t[o]),i=n+r;e.push({start:t[o-1],end:t[o],bearing:f(t[o-1],t[o]),length:r,startOrigin:n}),n=i}return e}function p(t){var e=0;if(t.length>1)for(var n=1;n<t.length;n++)e+=h(t[n-1],t[n]);return e}function h(t,e){var n=t[0],o=t[1],r=e[0],i=e[1],s=b(i-o),a=b(r-n),u=Math.pow(Math.sin(s/2),2)+Math.cos(b(o))*Math.cos(b(i))*Math.pow(Math.sin(a/2),2),c=2*Math.atan2(Math.sqrt(u),Math.sqrt(1-u));return c*d}function l(t,e,n){var o=b(t[0]),r=b(t[1]),i=b(n),s=e*v,a=Math.asin(Math.sin(r)*Math.cos(s)+Math.cos(r)*Math.sin(s)*Math.cos(i)),u=o+Math.atan2(Math.sin(i)*Math.sin(s)*Math.cos(r),Math.cos(s)-Math.sin(r)*Math.sin(a));return[y(u),y(a)]}function f(t,e){var n=b(t[0]),o=b(t[1]),r=b(e[0]),i=b(e[1]),s=Math.sin(r-n)*Math.cos(i),a=Math.cos(o)*Math.sin(i)-Math.sin(o)*Math.cos(i)*Math.cos(r-n);return y(Math.atan2(s,a))}var d=6371e3,v=1/d,b=function(t){return function(e){return e*t}}(Math.PI/180),y=function(t){return function(e){return e*t}}(180/Math.PI),g=function(){function t(t,e,n,o){void 0===t&&(t=-180),void 0===e&&(e=-90),void 0===n&&(n=180),void 0===o&&(o=-90),this._extent=[],this._extent=[t,e,n,o]}return Object.defineProperty(t.prototype,"lngMin",{get:function(){return this._extent[0]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"latMin",{get:function(){return this._extent[1]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"lngMax",{get:function(){return this._extent[2]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"latMax",{get:function(){return this._extent[3]},enumerable:!0,configurable:!0}),t.prototype.set=function(t){return this._extent=[t.lngMin,t.latMin,t.lngMax,t.latMin],this},t.prototype.setFromPoints=function(t){return this._extent=i(t),this},t.prototype.expand=function(t){return o(this._extent,t),this},t.prototype.toBbox=function(){return[this.lngMin,this.latMin,this.lngMax,this.latMax]},t.prototype.clone=function(){return(new t).set(this)},t}();g.AUSTRALIA=new g(113,(-44),154,(-10)),g.WORLD=new g((-180),(-90),180,90),g.REVERSE_WORLD=new g(180,90,(-180),(-90));var M=function(){function t(t){this.serviceUrlTemplate=t,this.diagonal=500}return t.prototype.getElevation=function(t,e){var n=this;return void 0===e&&(e=0),new Promise(function(t,e){n.extent=new g})},t.calcSides=function(t,e){var n=Math.sqrt(t*t/(1+e*e));return{y:Math.ceil(n),x:Math.ceil(n*e)}},t}(),x=function(){function t(){}return t.prototype.addEventListener=function(t,e){void 0===this.listeners&&(this.listeners={});var n=this.listeners;void 0===n[t]&&(n[t]=[]),n[t].indexOf(e)===-1&&n[t].push(e)},t.prototype.hasEventListener=function(t,e){if(void 0===this.listeners)return!1;var n=this.listeners;return void 0!==n[t]&&n[t].indexOf(e)!==-1},t.prototype.removeEventListener=function(t,e){if(void 0!==this.listeners){var n=this.listeners[t];void 0!==n&&(this.listeners[t]=n.filter(function(t){return e!==t}))}},t.prototype.dispatchEvent=function(t){var e=this,n=this.listeners;if(void 0!==n){var o=n[t.type];void 0!==o&&(t.target=this,o.forEach(function(n){return n.call(e,t)}))}},t.prototype.removeAllListeners=function(){this.listeners=void 0},t}(),m=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return e(n,t),n}(x),O=function(){function t(t,e,n){this.type=t,this.data=e,this.target=n}return t}(),w=function(t){function n(e,n,o){void 0===n&&(n={});var r=t.call(this)||this;return r.file=e,r.callback=o,r.reader=new FileReader,r}return e(n,t),n.prototype.load=function(){var t=this;return new Promise(function(e,n){var o=t;t.reader.onloadend=function(t){if(console.log("We have loaded with ready state = "+t.target.readyState),t.target.readyState===FileReader.prototype.DONE){var n=t.target.result;o.dispatchEvent(new O("data",n)),o.dispatchEvent(new O("complete",n)),e(n)}},t.reader.onerror=function(e){t.dispatchEvent(new O("error",{event:e})),n(e)},o.reader.readAsArrayBuffer(o.file)})},n}(m),P=function(t){function n(e,n){void 0===n&&(n={});var o=t.call(this)||this;return o.location=e,o.options=n,o}return e(n,t),n.prototype.load=function(){var t=this;return new Promise(function(e,n){var o=0,r=new XMLHttpRequest;r.addEventListener("readystatechange",function(n){if(null===r.readyState||!(r.readyState<3||200!==r.status)){var i=r.responseText;t.dispatchEvent(new O("data",i.substr(o))),o=i.length,4===r.readyState&&(t.dispatchEvent(new O("complete",r.responseText)),e(i))}},!1),r.addEventListener("error",function(e){t.dispatchEvent(new O("error",{event:e})),n(e)},!1),void 0!==t.options.crossOrigin&&(r.crossOrigin=t.options.crossOrigin),r.open("GET",t.location,!0),r.responseType="arraybuffer",r.send(null)})},Object.defineProperty(n.prototype,"crossOrigin",{set:function(t){this.options.crossOrigin=t},enumerable:!0,configurable:!0}),n}(m),E=function(t){function n(e){void 0===e&&(e={});var n=t.call(this)||this;return n.options=e,n}return e(n,t),n.prototype.load=function(){var t=this,e=this.options.loader?this.options.loader:new L(this.options);return void 0!==this.options.crossOrigin&&(e.crossOrigin=this.options.crossOrigin),e.load().then(function(e){var n=new GeotiffParser;return n.parseHeader(e),t.dispatchEvent(new O("header",{width:n.imageWidth,height:n.imageLength})),n.loadPixels()})},Object.defineProperty(n.prototype,"crossOrigin",{set:function(t){this.options.crossOrigin=t},enumerable:!0,configurable:!0}),n}(m),L=function(t){function n(e){void 0===e&&(e={});var n=t.call(this)||this;return n.options=e,n}return e(n,t),n.prototype.load=function(){var t=this;return new Promise(function(e,n){var o=r(t.options.extent.toBbox(),t.options.bbox);if(!o)return void n("Not within the data extent");var i=new XMLHttpRequest;i.addEventListener("load",function(t){e(t.target.response)},!1),i.addEventListener("error",function(t){n(t)},!1),void 0!==t.options.crossOrigin&&(i.crossOrigin=t.options.crossOrigin),i.open("GET",t.options.location,!0),i.responseType="arraybuffer",i.send(null)})},Object.defineProperty(n.prototype,"crossOrigin",{set:function(t){this.options.crossOrigin=t},enumerable:!0,configurable:!0}),n}(m),j=function(){function t(t){this.options=t}return t.prototype.load=function(){var t=this;return new E(this.options).load().then(function(e){return[t.options.point[0],t.options.point[1],e[0]]})},t}(),R=function(){function t(t){void 0===t&&(t={}),this.options=t}return Object.defineProperty(t.prototype,"template",{get:function(){return this.options.point},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"point",{get:function(){return this.options.point},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"bbox",{get:function(){return[this.point[0]-1e-6,this.point[1]-1e-6,this.point[0]+1e-6,this.point[1]+1e-6]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"extent",{get:function(){return new(g.bind.apply(g,[void 0].concat(this.bbox)))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"location",{get:function(){return this.template.replace("${resx}",1).replace("${resy}",1).replace("${width}",1).replace("${height}",1).replace("${bbox}",this.bbox.join(","))},enumerable:!0,configurable:!0}),t}(),T=function(t){function n(e){void 0===e&&(e={});var n=t.call(this)||this;return n.options=e,n}return e(n,t),Object.defineProperty(n.prototype,"point",{set:function(t){this.options.point=t},enumerable:!0,configurable:!0}),n.prototype.load=function(){var t=new R(this.options),e=new j(t);return e.load()},n}(m),X=function(){function t(t){this.options=t}return Object.defineProperty(t.prototype,"resolutionY",{get:function(){return this.options.resolutionY?this.options.resolutionY:Math.round(this.resolutionX*(this.bbox[3]-this.bbox[1])/(this.bbox[2]-this.bbox[0]))},set:function(t){this.options.resolutionY=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"resolutionX",{get:function(){return this.options.resolutionX?this.options.resolutionX:500},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"template",{get:function(){return this.options.template},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"bbox",{get:function(){return this.options.bbox},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"extent",{get:function(){return this.options.extent?this.options.extent:g.WORLD},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"location",{get:function(){return this.template.replace("${resx}",this.resolutionX).replace("${resy}",this.resolutionY).replace("${width}",this.resolutionX).replace("${height}",this.resolutionY).replace("${bbox}",this.bbox.join(","))},enumerable:!0,configurable:!0}),t}(),_=function(){function t(t){void 0===t&&(t={}),this.options=t}return t.prototype.load=function(){var t=new X(this.options),e=new E(t);return e.load()},t}(),S=function(t){function n(e){var n=t.call(this)||this;return n.options=e,n.resolutionX=500,n.extent=g.WORLD,n.childLoader=new E(e),n}return e(n,t),n.prototype.load=function(){var t=this.options,e=(this.options.template,t.bbox),n=(e[2]-e[0])/(t.resolutionX-1),o=(e[3]-e[1])/(t.resolutionY-1),r=e[3],i=e[0];return this.childLoader.load().then(function(e){return e.map(function(e,s){var a=s%t.resolutionX,u=Math.floor(s/t.resolutionX);return{x:i+a*n,y:r-u*o,z:e}})})},n}(m),D=function(t){function n(e){var n=t.call(this)||this;return n.options=e,n.childLoader=new S(e),n}return e(n,t),n.prototype.load=function(){var t=this.options,e=t.bbox;(e[2]-e[0])/(t.resolutionX-1),(e[3]-e[1])/(t.resolutionY-1),e[1],e[0];return this.childLoader.load().then(function(t){var n={type:"FeatureCollection",bbox:[e[0],e[1],e[2],e[3]],features:t.map(function(t){return{type:"Feature",properties:[],geometry:{type:"Point",coordinates:[t.x,t.y,t.z]}}})};return n})},n.prototype.calculateResolutionY=function(t,e,n){return n?n:Math.round(e*(t[3]-t[1])/(t[2]-t[0]))},n}(m),A=function(){function t(t){void 0===t&&(t={}),this.options=t}return t.prototype.load=function(){var t=new X(this.options),e=new D(t);return e.load()},t}(),I=function(){function t(t){this.options=t}return t.prototype.load=function(){var t=new X(this.options),e=new S(t);return e.load()},t}(),$=function(){function t(t){this.options=t,this.childLoader=new E(t)}return t.prototype.load=function(){var t=this;return this.childLoader.load().then(function(e){var n,o=[];return e.forEach(function(e,r){r%t.options.resolutionX||(n=[],o.push(n)),n.push(e)}),o})},t}();t.Extent2d=g,t.Transection=M,t.FileLoader=w,t.HttpTextLoader=P,t.CswPointElevationLoader=T,t.CswTerrainLoader=_,t.CswGeoJsonLoader=A,t.CswXyzLoader=I,t.TerrainLoader=E,t.PointElevationLoader=j,t.GeojsonElevationLoader=D,t.GridElevationLoader=$,t.XyzElevationLoader=S,t.RADIANS_TO_METERS=d,t.METERS_TO_RADIANS=v,t.convertDegreesToRadians=b,t.convertRadiansToDegree=y,t.normalizeRadians=n,t.expandBbox=o,t.culledBbox=r,t.createBboxFromPoints=i,t.positionWithinBbox=s,t.densify=a,t.calculatePosition=u,t.calculateSegmentDetails=c,t.calculateLineLength=p,t.calculateDistance=h,t.destination=l,t.calculateBearing=f,Object.defineProperty(t,"__esModule",{value:!0})});