!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e(t.Elevation=t.Elevation||{})}(this,function(t){"use strict";function e(t,e){function n(){this.constructor=t}for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o]);t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}function n(t){return t*Math.PI/180}function o(t){return 180*t/Math.PI}function r(t){for(var e=t;e<=-Math.PI;)e+=2*Math.PI;for(;e>Math.PI;)e-=2*Math.PI;return e}function i(t,e){t[0]=Math.min(t[0],e[0]),t[1]=Math.min(t[1],e[1]),t[2]=Math.max(t[2],e[0]),t[3]=Math.max(t[3],e[1])}function a(t,e){var n=e[0]<t[0]?t[0]:e[0],o=e[2]>t[2]?t[2]:e[2],r=e[1]<t[1]?t[1]:e[1],i=e[3]>t[3]?t[3]:e[3];return n>e[2]||o<e[0]||i<e[1]||r>e[3]||n>=o||i<=r?null:[n,r,o,i]}function s(t,e){void 0===e&&(e=0);var n=[1/0,1/0,-(1/0),-(1/0)];return t.forEach(function(t){i(n,t)}),e?u(n,e):n}function u(t,e){var n=(t[2]-t[0])*e,o=(t[3]-t[1])*e;return[t[0]-n,t[1]-o,t[2]+n,t[3]+o]}function c(t,e){return t[0]<=e[0]&&t[1]<=e[1]&&t[2]>=e[0]&&t[3]>=e[1]}function p(t,e){for(var n=l(t),o=f(t)/(e-1),r=0,i=[t[0]],a=1;a<e-1;a++){for(var s=o*a;s>n[r].startOrigin+n[r].length;)r++;var u=n[r],c=h(u.start,u.bearing,s-u.startOrigin);i.push(c)}return i.push(t[t.length-1]),i}function h(t,e,i){var a=i/6371e3,s=n(e),u=n(t[0]),c=n(t[1]),p=Math.asin(Math.sin(c)*Math.cos(a)+Math.cos(c)*Math.sin(a)*Math.cos(s)),h=u+Math.atan2(Math.sin(s)*Math.sin(a)*Math.cos(c),Math.cos(a)-Math.sin(c)*Math.sin(p));return h=r(h),[o(h),o(p)]}function l(t){if(t.length<2)return[0];for(var e=[],n=0,o=1;o<t.length;o++){var r=d(t[o-1],t[o]),i=n+r;e.push({start:t[o-1],end:t[o],bearing:b(t[o-1],t[o]),length:r,startOrigin:n}),n=i}return e}function f(t){var e=0;if(t.length>1)for(var n=1;n<t.length;n++)e+=d(t[n-1],t[n]);return e}function d(t,e){var o=t[0],r=t[1],i=e[0],a=e[1],s=n(a-r),u=n(i-o),c=Math.pow(Math.sin(s/2),2)+Math.cos(n(r))*Math.cos(n(a))*Math.pow(Math.sin(u/2),2),p=2*Math.atan2(Math.sqrt(c),Math.sqrt(1-c));return p*g}function v(t,e,r){var i=n(t[0]),a=n(t[1]),s=n(r),u=e*M,c=Math.asin(Math.sin(a)*Math.cos(u)+Math.cos(a)*Math.sin(u)*Math.cos(s)),p=i+Math.atan2(Math.sin(s)*Math.sin(u)*Math.cos(a),Math.cos(u)-Math.sin(a)*Math.sin(c));return[o(p),o(c)]}function b(t,e){var r=n(t[0]),i=n(t[1]),a=n(e[0]),s=n(e[1]),u=Math.sin(a-r)*Math.cos(s),c=Math.cos(i)*Math.sin(s)-Math.sin(i)*Math.cos(s)*Math.cos(a-r);return o(Math.atan2(u,c))}function y(t,e){var n=Math.sqrt(t*t/(1+e*e));return{y:Math.ceil(n),x:Math.ceil(n*e)}}var g=6371e3,M=1/g,x=function(){function t(t,e,n,o){void 0===t&&(t=-180),void 0===e&&(e=-90),void 0===n&&(n=180),void 0===o&&(o=-90),this._extent=[],this._extent=[t,e,n,o]}return Object.defineProperty(t.prototype,"lngMin",{get:function(){return this._extent[0]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"latMin",{get:function(){return this._extent[1]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"lngMax",{get:function(){return this._extent[2]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"latMax",{get:function(){return this._extent[3]},enumerable:!0,configurable:!0}),t.prototype.set=function(t){return this._extent=[t.lngMin,t.latMin,t.lngMax,t.latMin],this},t.prototype.setFromPoints=function(t){return this._extent=s(t),this},t.prototype.expand=function(t){return i(this._extent,t),this},t.prototype.toBbox=function(){return[this.lngMin,this.latMin,this.lngMax,this.latMax]},t.prototype.clone=function(){return(new t).set(this)},t}();x.AUSTRALIA=new x(113,(-44),154,(-10)),x.WORLD=new x((-180),(-90),180,90),x.REVERSE_WORLD=new x(180,90,(-180),(-90));var m=function(){function t(t){this.serviceUrlTemplate=t,this.diagonal=500}return t.prototype.getElevation=function(t,e){var n=this;return void 0===e&&(e=0),new Promise(function(t,e){n.extent=new x})},t.calcSides=function(t,e){var n=Math.sqrt(t*t/(1+e*e));return{y:Math.ceil(n),x:Math.ceil(n*e)}},t}(),O=function(){function t(){}return t.prototype.addEventListener=function(t,e){void 0===this.listeners&&(this.listeners={});var n=this.listeners;void 0===n[t]&&(n[t]=[]),n[t].indexOf(e)===-1&&n[t].push(e)},t.prototype.hasEventListener=function(t,e){if(void 0===this.listeners)return!1;var n=this.listeners;return void 0!==n[t]&&n[t].indexOf(e)!==-1},t.prototype.removeEventListener=function(t,e){if(void 0!==this.listeners){var n=this.listeners[t];void 0!==n&&(this.listeners[t]=n.filter(function(t){return e!==t}))}},t.prototype.dispatchEvent=function(t){var e=this,n=this.listeners;if(void 0!==n){var o=n[t.type];void 0!==o&&(t.target=this,o.forEach(function(n){return n.call(e,t)}))}},t.prototype.removeAllListeners=function(){this.listeners=void 0},t}(),w=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return e(n,t),n}(O),P=function(){function t(t,e,n){this.type=t,this.data=e,this.target=n}return t}(),L=function(t){function n(e,n,o){void 0===n&&(n={});var r=t.call(this)||this;return r.file=e,r.callback=o,r.reader=new FileReader,r}return e(n,t),n.prototype.load=function(){var t=this;return new Promise(function(e,n){var o=t;t.reader.onloadend=function(t){if(console.log("We have loaded with ready state = "+t.target.readyState),t.target.readyState===FileReader.prototype.DONE){var n=t.target.result;o.dispatchEvent(new P("data",n)),o.dispatchEvent(new P("complete",n)),e(n)}},t.reader.onerror=function(e){t.dispatchEvent(new P("error",{event:e})),n(e)},o.reader.readAsArrayBuffer(o.file)})},n}(w),E=function(t){function n(e){var n=t.call(this)||this;return n.options=e,n.loading=!1,n.options.data&&(n.data=n.options.data),n}return e(n,t),n.prototype.load=function(){var t=this;return this.data?Promise.resolve(this.data):(this.deferred||(this.deferred=this.options.loader.load().then(function(e){return t.data=e,e})),this.deferred)},n}(w),j=function(t){function n(e,n){void 0===n&&(n={});var o=t.call(this)||this;return o.location=e,o.options=n,o}return e(n,t),n.prototype.load=function(){var t=this;return new Promise(function(e,n){var o=0,r=new XMLHttpRequest;r.addEventListener("readystatechange",function(n){if(null===r.readyState||!(r.readyState<3||200!==r.status)){var i=r.responseText;t.dispatchEvent(new P("data",i.substr(o))),o=i.length,4===r.readyState&&(t.dispatchEvent(new P("complete",r.responseText)),e(i))}},!1),r.addEventListener("error",function(e){t.dispatchEvent(new P("error",{event:e})),n(e)},!1),void 0!==t.options.crossOrigin&&(r.crossOrigin=t.options.crossOrigin),r.open("GET",t.location,!0),r.responseType="arraybuffer",r.send(null)})},Object.defineProperty(n.prototype,"crossOrigin",{set:function(t){this.options.crossOrigin=t},enumerable:!0,configurable:!0}),n}(w),R=function(t){function n(e){void 0===e&&(e={});var n=t.call(this)||this;return n.options=e,n}return e(n,t),n.prototype.load=function(){var t=this,e=this.options.loader?this.options.loader:new T(this.options);return void 0!==this.options.crossOrigin&&(e.crossOrigin=this.options.crossOrigin),e.load().then(function(e){var n=new GeotiffParser;return n.parseHeader(e),t.dispatchEvent(new P("header",{width:n.imageWidth,height:n.imageLength})),n.loadPixels()})},Object.defineProperty(n.prototype,"crossOrigin",{set:function(t){this.options.crossOrigin=t},enumerable:!0,configurable:!0}),n}(w),T=function(t){function n(e){void 0===e&&(e={});var n=t.call(this)||this;return n.options=e,n}return e(n,t),n.prototype.load=function(){var t=this;return new Promise(function(e,n){var o=a(t.options.extent.toBbox(),t.options.bbox);if(!o)return void n("Not within the data extent");var r=new XMLHttpRequest;r.addEventListener("load",function(t){e(t.target.response)},!1),r.addEventListener("error",function(t){n(t)},!1),void 0!==t.options.crossOrigin&&(r.crossOrigin=t.options.crossOrigin),r.open("GET",t.options.location,!0),r.responseType="arraybuffer",r.send(null)})},Object.defineProperty(n.prototype,"crossOrigin",{set:function(t){this.options.crossOrigin=t},enumerable:!0,configurable:!0}),n}(w),X=function(){function t(t){this.options=t}return t.prototype.load=function(){var t=this;return new R(this.options).load().then(function(e){return[t.options.point[0],t.options.point[1],e[0]]})},t}(),_=function(){function t(t){void 0===t&&(t={}),this.options=t}return Object.defineProperty(t.prototype,"template",{get:function(){return this.options.point},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"point",{get:function(){return this.options.point},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"bbox",{get:function(){return[this.point[0]-1e-6,this.point[1]-1e-6,this.point[0]+1e-6,this.point[1]+1e-6]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"extent",{get:function(){return new(x.bind.apply(x,[void 0].concat(this.bbox)))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"location",{get:function(){return this.template.replace("${resx}",1).replace("${resy}",1).replace("${width}",1).replace("${height}",1).replace("${bbox}",this.bbox.join(","))},enumerable:!0,configurable:!0}),t}(),S=function(t){function n(e){void 0===e&&(e={});var n=t.call(this)||this;return n.options=e,n}return e(n,t),Object.defineProperty(n.prototype,"point",{set:function(t){this.options.point=t},enumerable:!0,configurable:!0}),n.prototype.load=function(){var t=new _(this.options),e=new X(t);return e.load()},n}(w),W=function(){function t(t){this.options=t}return Object.defineProperty(t.prototype,"resolutionY",{get:function(){return this.options.resolutionY?this.options.resolutionY:Math.round(this.options.resolutionX*(this.options.bbox[3]-this.options.bbox[1])/(this.options.bbox[2]-this.options.bbox[0]))},set:function(t){this.options.resolutionY=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"resolutionX",{get:function(){return this.options.resolutionX?this.options.resolutionX:500},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"template",{get:function(){return this.options.template},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"bbox",{get:function(){return this.options.bbox},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"extent",{get:function(){return this.options.extent?this.options.extent:x.WORLD},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"location",{get:function(){return this.template.replace("${resx}",this.resolutionX).replace("${resy}",this.resolutionY).replace("${width}",this.resolutionX).replace("${height}",this.resolutionY).replace("${bbox}",this.bbox.join(","))},enumerable:!0,configurable:!0}),t}(),D=function(){function t(t){void 0===t&&(t={}),this.options=t}return t.prototype.load=function(){var t=new W(this.options),e=new R(t);return e.load()},t}(),B=function(t){function n(e){var n=t.call(this)||this;return n.options=e,n.resolutionX=500,n.extent=x.WORLD,n.childLoader=new R(e),n}return e(n,t),n.prototype.load=function(){var t=this.options,e=(this.options.template,t.bbox),n=(e[2]-e[0])/(t.resolutionX-1),o=(e[3]-e[1])/(t.resolutionY-1),r=e[3],i=e[0];return this.childLoader.load().then(function(e){return e.map(function(e,a){var s=a%t.resolutionX,u=Math.floor(a/t.resolutionX);return{x:i+s*n,y:r-u*o,z:e}})})},n}(w),A=function(t){function n(e){var n=t.call(this)||this;return n.options=e,n.childLoader=new B(e),n}return e(n,t),n.prototype.load=function(){var t=this.options,e=t.bbox;(e[2]-e[0])/(t.resolutionX-1),(e[3]-e[1])/(t.resolutionY-1),e[1],e[0];return this.childLoader.load().then(function(t){var n={type:"FeatureCollection",bbox:[e[0],e[1],e[2],e[3]],features:t.map(function(t){return{type:"Feature",properties:[],geometry:{type:"Point",coordinates:[t.x,t.y,t.z]}}})};return n})},n.prototype.calculateResolutionY=function(t,e,n){return n?n:Math.round(e*(t[3]-t[1])/(t[2]-t[0]))},n}(w),F=function(){function t(t){void 0===t&&(t={}),this.options=t}return t.prototype.load=function(){var t=new W(this.options),e=new A(t);return e.load()},t}(),I=function(){function t(t){this.options=t}return t.prototype.load=function(){var t=new W(this.options),e=new B(t);return e.load()},t}(),Y=function(t){function n(e){void 0===e&&(e={});var n=t.call(this)||this;return n.options=e,n}return e(n,t),Object.defineProperty(n.prototype,"path",{set:function(t){this.options.path=t},enumerable:!0,configurable:!0}),n.prototype.load=function(){var t=s(this.options.path,this.options.buffer),e=this.options.extent?this.options.extent:x.WORLD;t=a(e.toBbox(),t);var n=Object.assign({bbox:t,extent:e,count:this.options.count?this.options.count:500},this.options),o=p(n.path,n.count?n.count:500),r=t[0],i=t[3],u=t[2]-r,c=i-t[1],h=y(n.count,u/c);return n.resolutionX=h.x,n.resolutionY=h.y,new R(new W(n)).load().then(function(t){function e(e){var n=e[0],o=e[1],a=r,s=i,p=Math.round((s-o)/c*(h.y-1)),l=Math.round((n-a)/u*(h.x-1)),f=p*h.x+l;return console.log("Cell x = "+l+", y = "+p+" Index = "+f+", value = "+t[f]),t[f]}return n.line?{type:"Feature",geometry:{type:"LineString",coordinates:o.map(function(t){return[t[0],t[1],e(t)]})}}:{type:"FeatureCollection",features:o.map(function(t){return{type:"Feature",geometry:{type:"Point",coordinates:[t[0],t[1],e(t)]}}})}})},n}(w),$=function(){function t(t){this.options=t,this.childLoader=new R(t)}return t.prototype.load=function(){var t=this;return this.childLoader.load().then(function(e){var n,o=[];return e.forEach(function(e,r){r%t.options.resolutionX||(n=[],o.push(n)),n.push(e)}),o})},t}();t.Extent2d=x,t.Transection=m,t.FileLoader=L,t.CachedLoader=E,t.HttpTextLoader=j,t.WcsPointElevationLoader=S,t.WcsTerrainLoader=D,t.WcsGeoJsonLoader=F,t.WcsXyzLoader=I,t.TerrainLoader=R,t.WcsPathElevationLoader=Y,t.PointElevationLoader=X,t.GeojsonElevationLoader=A,t.GridElevationLoader=$,t.XyzElevationLoader=B,t.RADIANS_TO_METERS=g,t.METERS_TO_RADIANS=M,t.convertDegreesToRadians=n,t.convertRadiansToDegree=o,t.normalizeRadians=r,t.expandBbox=i,t.culledBbox=a,t.createBboxFromPoints=s,t.createBufferedBbox=u,t.positionWithinBbox=c,t.densify=p,t.calculatePosition=h,t.calculateSegmentDetails=l,t.calculateLineLength=f,t.calculateDistance=d,t.destination=v,t.calculateBearing=b,Object.defineProperty(t,"__esModule",{value:!0})});